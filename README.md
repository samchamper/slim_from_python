# Running SLiM in arrays, from Python, from R, and on a computing cluster

You may find yourself in the situation that you have a SLiM (https://messerlab.org/slim/, https://github.com/MesserLab/SLiM) simulation with several defined parameters, and you want to try varying these parameters through a plausable range in order to determine how the model will perform in various configurations.

Naturally, you can just vary the parameters by hand and record the results. However, that wouldn't be very fun once you have more than two or three parameters that you want to vary. Furthermore, running SLiM many times sequentially takes a lot longer than doing it in parallel!

In this situation, there are several options. This repository is designed to demostrate the basics of several methods to solve this problem!

Note: the scripts in this repository all assume that SLiM is in your PATH environment variable. To check if it is, open a console and type "slim". If the SLiM version info and command line help pops up, you're good to go. Otherwise, you'll need to add it to PATH. If you don't know how, the method for doing so varies between operating systems - search for a tutorial that is right for yours.

Note 2: The scripts in this repository are compatible with Python version 3.6 and above.

## 1 - Preparing your SLiM file for command line configuration

Just as you can use the defineConstant() function to... well... define constants within SLiM, you can use the command line "-d" argument to do so as well.

For example invoking: ``slim -d X=0.0 -d Y=1.0 filename.slim`` will run SLiM with X in the namespace as 0 and Y as 1. This can be used in conjunction with other tools to run many SLiM simulations while varying parameters.

However, you'll need to make sure not to define the same constants twice! Doing so results in an error. To define a constant "X" to have a default value of 1.0 within SLiM in such a way that it can also be defined via the command line without causing an error, use the following code:
```
if (!exists("X"))
    defineConstant(X, 1.0);
```
However, if you plan to use dozens of configurable constants, this may start to take up a lot of space, and a small helper function can clean this up. See the "minimal_gene_drive.slim" file for an example of how this is done.

## 2 - Using bash to run SLiM

Once your SLiM file is prepared, running it with varrying parameters using bash is easy. Just a simple list of the command line strings you want to run is sufficient, though you may also want to pipe the output of each simulation to its own file via "``>``" (e.g. "``command > output.txt``"). You can also run jobs in parallel very easily.

In this repository, the "array_without_python.sh" file demonstrates how to accomplish parallel running with bash!

## 3 - Using Python to run SLiM

You might find that you want to do some complex analyses on your data which are inconvenient to do from within SLiM itself. If so, you can capture the results of SLiM within Python using the subprocess library, and then use all of your favorite python libraries to analyze the output!

For a fairly minimal example of such a driver, see the "minimal_slim_driver.py" file in this repository.

## 4 - Using Python and bash to run an array in parallel

Running SLiM in parallel with bash and running SLiM with python can be combined. The "array_with_python.sh" script in this repository demonstrates this method. This could also be combined with a script to generate a bash file: see "generate_large_local_array_run.py". The file "large_local_array_run.sh" was generated by invoking ``generate_large_local_array_run.py > large_local_array_run.sh``.

## 5 - Using Python, bash, and a job scheduler on a computing cluster to run an array in parallel

If you have access to a computing cluster, using it will likely entail submitting "jobs" to a "job scheduler". The scripts you will use to run an array of jobs depend on exactly what job scheduler your computer cluster uses, so go talk to your friendly cluster administrator.

Included in this repository are scripts for running an array of jobs using two popular schedulers: the Sun Grid Engine (aka SGE), and SLURM. Files for these examples include "generate_params_file.py", which generates a file containing the command line strings that the cluster will be running (by invoking ``generate_params_file.py > params.txt``. The cluster scripts themselves are "SGE.sh", "SLURM.sh" and "SLURM_simple.sh".

## BONUS - SLiM in R!

SLiM can also be run using R. The "running_slim_using_r.r" script in this repository demonstrates this, first in a very minimal way, then an example of how to run an array of SLiM simulations in parallel from within R. There may be better ways to do this - I do not know R as well as Python!

## BONUS #2 - Using data from an array of SLiM runs!

Being able to conveniently run SLiM many times means lots of data. For a fun example of what to do with such data, see "matplotlib_script.py" (this file has several Python package dependencies, so you may need to install them through your favorite Python package manager).
